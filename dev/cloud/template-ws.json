{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "workspaces_TxtsumDemo_name": {
            "defaultValue": "TxtsumDemo",
            "type": "String"
        },
        "storageaccounts_txtsumdemostorage_externalid": {
            "defaultValue": "/subscriptions/6560575d-fa06-4e7d-95fb-f962e74efd7a/resourceGroups/uw-embeddings/providers/microsoft.storage/storageaccounts/txtsumdemostorage",
            "type": "String"
        },
        "vaults_txtsumdemokeyvault_externalid": {
            "defaultValue": "/subscriptions/6560575d-fa06-4e7d-95fb-f962e74efd7a/resourceGroups/uw-embeddings/providers/microsoft.keyvault/vaults/txtsumdemokeyvault",
            "type": "String"
        },
        "components_txtsumdemoinsights_externalid": {
            "defaultValue": "/subscriptions/6560575d-fa06-4e7d-95fb-f962e74efd7a/resourceGroups/uw-embeddings/providers/microsoft.insights/components/txtsumdemoinsights",
            "type": "String"
        },
        "registries_txtsumdemoregistry_externalid": {
            "defaultValue": "/subscriptions/6560575d-fa06-4e7d-95fb-f962e74efd7a/resourceGroups/uw-embeddings/providers/microsoft.containerregistry/registries/txtsumdemoregistry",
            "type": "String"
        }
    },
    "variables": {},
    "resources": [
        {
            "type": "Microsoft.MachineLearningServices/workspaces",
            "apiVersion": "2021-04-01",
            "name": "[parameters('workspaces_TxtsumDemo_name')]",
            "location": "westus2",
            "sku": {
                "name": "Basic",
                "tier": "Basic"
            },
            "identity": {
                "principalId": "ca8f5afa-72f3-4366-a6bf-ca025d53f98b",
                "tenantId": "72f988bf-86f1-41af-91ab-2d7cd011db47",
                "type": "SystemAssigned"
            },
            "properties": {
                "friendlyName": "[parameters('workspaces_TxtsumDemo_name')]",
                "storageAccount": "[parameters('storageaccounts_txtsumdemostorage_externalid')]",
                "keyVault": "[parameters('vaults_txtsumdemokeyvault_externalid')]",
                "applicationInsights": "[parameters('components_txtsumdemoinsights_externalid')]",
                "hbiWorkspace": false,
                "containerRegistry": "[parameters('registries_txtsumdemoregistry_externalid')]",
                "allowPublicAccessWhenBehindVnet": false,
                "discoveryUrl": "https://westus2.api.azureml.ms/discovery"
            }
        },
        {
            "type": "Microsoft.MachineLearningServices/workspaces/computes",
            "apiVersion": "2021-04-01",
            "name": "[concat(parameters('workspaces_TxtsumDemo_name'), '/gpu-v100-8')]",
            "location": "westus2",
            "dependsOn": [
                "[resourceId('Microsoft.MachineLearningServices/workspaces', parameters('workspaces_TxtsumDemo_name'))]"
            ],
            "properties": {
                "disableLocalAuth": false,
                "computeType": "AmlCompute",
                "computeLocation": "westus2",
                "properties": {
                    "vmSize": "STANDARD_ND40RS_V2",
                    "vmPriority": "Dedicated",
                    "scaleSettings": {
                        "maxNodeCount": 1,
                        "minNodeCount": 0,
                        "nodeIdleTimeBeforeScaleDown": "PT5M"
                    },
                    "remoteLoginPortPublicAccess": "Enabled",
                    "osType": "Linux",
                    "isolatedNetwork": false
                }
            }
        },
        {
            "type": "Microsoft.MachineLearningServices/workspaces/computes",
            "apiVersion": "2021-04-01",
            "name": "[concat(parameters('workspaces_TxtsumDemo_name'), '/gpu-v100-8-lp')]",
            "location": "westus2",
            "dependsOn": [
                "[resourceId('Microsoft.MachineLearningServices/workspaces', parameters('workspaces_TxtsumDemo_name'))]"
            ],
            "properties": {
                "disableLocalAuth": false,
                "computeType": "AmlCompute",
                "computeLocation": "westus2",
                "properties": {
                    "vmSize": "STANDARD_ND40RS_V2",
                    "vmPriority": "LowPriority",
                    "scaleSettings": {
                        "maxNodeCount": 1,
                        "minNodeCount": 0,
                        "nodeIdleTimeBeforeScaleDown": "PT5M"
                    },
                    "remoteLoginPortPublicAccess": "Enabled",
                    "osType": "Linux",
                    "isolatedNetwork": false
                }
            }
        },
        {
            "type": "Microsoft.MachineLearningServices/workspaces/data",
            "apiVersion": "2021-03-01-preview",
            "name": "[concat(parameters('workspaces_TxtsumDemo_name'), '/hf-samsum')]",
            "dependsOn": [
                "[resourceId('Microsoft.MachineLearningServices/workspaces', parameters('workspaces_TxtsumDemo_name'))]"
            ],
            "properties": {
                "properties": {},
                "tags": {}
            }
        },
        {
            "type": "Microsoft.MachineLearningServices/workspaces/datastores",
            "apiVersion": "2021-03-01-preview",
            "name": "[concat(parameters('workspaces_TxtsumDemo_name'), '/workspaceblobstore')]",
            "dependsOn": [
                "[resourceId('Microsoft.MachineLearningServices/workspaces', parameters('workspaces_TxtsumDemo_name'))]"
            ],
            "properties": {
                "contents": {
                    "contentsType": "AzureBlob",
                    "accountName": "txtsumdemostorage",
                    "containerName": "azureml-blobstore-348a486a-89be-45b7-8668-dcf4512113af",
                    "endpoint": "core.windows.net",
                    "protocol": "https",
                    "credentials": {
                        "credentialsType": "AccountKey"
                    }
                },
                "isDefault": true
            }
        },
        {
            "type": "Microsoft.MachineLearningServices/workspaces/datastores",
            "apiVersion": "2021-03-01-preview",
            "name": "[concat(parameters('workspaces_TxtsumDemo_name'), '/workspacefilestore')]",
            "dependsOn": [
                "[resourceId('Microsoft.MachineLearningServices/workspaces', parameters('workspaces_TxtsumDemo_name'))]"
            ],
            "properties": {
                "contents": {
                    "contentsType": "AzureFile",
                    "accountName": "txtsumdemostorage",
                    "containerName": "azureml-filestore-348a486a-89be-45b7-8668-dcf4512113af",
                    "endpoint": "core.windows.net",
                    "protocol": "https",
                    "credentials": {
                        "credentialsType": "AccountKey"
                    }
                },
                "isDefault": false
            }
        },
        {
            "type": "Microsoft.MachineLearningServices/workspaces/environments",
            "apiVersion": "2021-03-01-preview",
            "name": "[concat(parameters('workspaces_TxtsumDemo_name'), '/hf-zero-gpu')]",
            "dependsOn": [
                "[resourceId('Microsoft.MachineLearningServices/workspaces', parameters('workspaces_TxtsumDemo_name'))]"
            ],
            "properties": {
                "properties": {},
                "tags": {}
            }
        },
        {
            "type": "Microsoft.MachineLearningServices/workspaces/environments/versions",
            "apiVersion": "2021-03-01-preview",
            "name": "[concat(parameters('workspaces_TxtsumDemo_name'), '/hf-zero-gpu/1')]",
            "dependsOn": [
                "[resourceId('Microsoft.MachineLearningServices/workspaces/environments', parameters('workspaces_TxtsumDemo_name'), 'hf-zero-gpu')]",
                "[resourceId('Microsoft.MachineLearningServices/workspaces', parameters('workspaces_TxtsumDemo_name'))]"
            ],
            "properties": {
                "tags": {},
                "properties": {},
                "isAnonymous": false,
                "docker": {
                    "platform": {
                        "operatingSystemType": "Linux"
                    },
                    "dockerSpecificationType": "Image",
                    "dockerImageUri": "mcr.microsoft.com/azureml/openmpi4.1.0-cuda11.1-cudnn8-ubuntu18.04:latest"
                },
                "condaFile": "{\n  \"channels\": [\n    \"pytorch\",\n    \"nvidia\",\n    \"conda-forge\"\n  ],\n  \"dependencies\": [\n    \"python=3.8\",\n    \"pytorch=1.9.0\",\n    \"cudatoolkit=11.1\",\n    \"pip\",\n    {\n      \"pip\": [\n        \"numpy\",\n        \"nltk\",\n        \"protobuf\",\n        \"py7zr\",\n        \"sentencepiece\",\n        \"datasets\",\n        \"git+https://github.com/huggingface/transformers\",\n        \"rouge-score\",\n        \"mlflow\",\n        \"azureml-mlflow\",\n        \"codecarbon\",\n        \"deepspeed\",\n        \"fairscale\"\n      ]\n    }\n  ],\n  \"name\": \"azureml_8db0ad68ca506622653cab01e942c9da\"\n}"
            }
        },
        {
            "type": "Microsoft.MachineLearningServices/workspaces/data/versions",
            "apiVersion": "2021-03-01-preview",
            "name": "[concat(parameters('workspaces_TxtsumDemo_name'), '/hf-samsum/1')]",
            "dependsOn": [
                "[resourceId('Microsoft.MachineLearningServices/workspaces/data', parameters('workspaces_TxtsumDemo_name'), 'hf-samsum')]",
                "[resourceId('Microsoft.MachineLearningServices/workspaces', parameters('workspaces_TxtsumDemo_name'))]",
                "[resourceId('Microsoft.MachineLearningServices/workspaces/datastores', parameters('workspaces_TxtsumDemo_name'), 'workspaceblobstore')]"
            ],
            "properties": {
                "tags": {},
                "properties": {},
                "isAnonymous": false,
                "datastoreId": "[resourceId('Microsoft.MachineLearningServices/workspaces/datastores', parameters('workspaces_TxtsumDemo_name'), 'workspaceblobstore')]",
                "path": "LocalUpload/0de2cac8a96e39b6f084542b2f369071/hf-samsum",
                "datasetType": "Simple"
            }
        },
        {
            "type": "Microsoft.MachineLearningServices/workspaces/jobs",
            "apiVersion": "2021-03-01-preview",
            "name": "[concat(parameters('workspaces_TxtsumDemo_name'), '/cmd-job-deepspeed')]",
            "dependsOn": [
                "[resourceId('Microsoft.MachineLearningServices/workspaces', parameters('workspaces_TxtsumDemo_name'))]",
                "[resourceId('Microsoft.MachineLearningServices/workspaces/computes', parameters('workspaces_TxtsumDemo_name'), 'gpu-v100-8')]",
                "[resourceId('Microsoft.MachineLearningServices/workspaces/environments/versions', parameters('workspaces_TxtsumDemo_name'), 'hf-zero-gpu', '1')]"
            ],
            "properties": {
                "tags": {
                    "_aml_system_ComputeTargetStatus": "{\"AllocationState\":\"steady\",\"PreparingNodeCount\":0,\"RunningNodeCount\":0,\"CurrentNodeCount\":0}",
                    "mlflow.source.type": "JOB"
                },
                "properties": {
                    "_azureml.ComputeTargetType": "amlcompute",
                    "ContentSnapshotId": "4e919df0-16a7-4a0b-9bdc-670750144207",
                    "ProcessInfoFile": "azureml-logs/process_info.json",
                    "ProcessStatusFile": "azureml-logs/process_status.json"
                },
                "jobType": "Command",
                "compute": {
                    "target": "[resourceId('Microsoft.MachineLearningServices/workspaces/computes', parameters('workspaces_TxtsumDemo_name'), 'gpu-v100-8')]",
                    "instanceCount": 1,
                    "isLocal": false
                },
                "experimentName": "hf-deepspeed-demo",
                "codeId": "[concat(resourceId('Microsoft.MachineLearningServices/workspaces', parameters('workspaces_TxtsumDemo_name')), '/codes/hf-txtsum-deepspeed/versions/1')]",
                "command": "deepspeed main.py --deepspeed './configs/ds-zero2.json' --model_name_or_path 'facebook/bart-large-xsum' --dataset_name 'samsum' --max_source_length 512 --max_target_length 90 --fp16 True --seed 1 --per_device_train_batch_size 16 --per_device_eval_batch_size 16 --learning_rate 5e-5 --weight_decay 0.1 --evaluation_strategy 'epoch' --logging_strategy 'epoch' --do_train --do_predict --predict_with_generate --overwrite_output_dir --output_dir './outputs' --logging_dir './logs' --ddp_find_unused_parameters False\n",
                "environmentId": "[resourceId('Microsoft.MachineLearningServices/workspaces/environments/versions', parameters('workspaces_TxtsumDemo_name'), 'hf-zero-gpu', '1')]",
                "inputDataBindings": {},
                "outputDataBindings": {},
                "environmentVariables": {}
            }
        },
        {
            "type": "Microsoft.MachineLearningServices/workspaces/jobs",
            "apiVersion": "2021-03-01-preview",
            "name": "[concat(parameters('workspaces_TxtsumDemo_name'), '/cmd-job-pytorch')]",
            "dependsOn": [
                "[resourceId('Microsoft.MachineLearningServices/workspaces', parameters('workspaces_TxtsumDemo_name'))]",
                "[resourceId('Microsoft.MachineLearningServices/workspaces/computes', parameters('workspaces_TxtsumDemo_name'), 'gpu-v100-8-lp')]",
                "[resourceId('Microsoft.MachineLearningServices/workspaces/environments/versions', parameters('workspaces_TxtsumDemo_name'), 'hf-zero-gpu', '1')]"
            ],
            "properties": {
                "tags": {
                    "_aml_system_ComputeTargetStatus": "{\"AllocationState\":\"steady\",\"PreparingNodeCount\":0,\"RunningNodeCount\":0,\"CurrentNodeCount\":0}",
                    "mlflow.source.type": "JOB"
                },
                "properties": {
                    "_azureml.ComputeTargetType": "amlcompute",
                    "ContentSnapshotId": "813a1325-5e52-4a4f-8667-6ebe5bcd1e18",
                    "ProcessInfoFile": "azureml-logs/process_info.json",
                    "ProcessStatusFile": "azureml-logs/process_status.json"
                },
                "jobType": "Command",
                "compute": {
                    "target": "[resourceId('Microsoft.MachineLearningServices/workspaces/computes', parameters('workspaces_TxtsumDemo_name'), 'gpu-v100-8-lp')]",
                    "instanceCount": 1,
                    "isLocal": false
                },
                "experimentName": "hf-pytorch-demo",
                "codeId": "[concat(resourceId('Microsoft.MachineLearningServices/workspaces', parameters('workspaces_TxtsumDemo_name')), '/codes/hf-txtsum/versions/1')]",
                "command": "python main.py --model_name_or_path 'facebook/bart-large-xsum' --dataset_name 'samsum' --max_source_length 512 --max_target_length 90 --fp16 True --seed 1 --per_device_train_batch_size 16 --per_device_eval_batch_size 16 --learning_rate 5e-5 --evaluation_strategy 'epoch' --logging_strategy 'epoch' --do_train --do_predict --predict_with_generate --overwrite_output_dir --output_dir './outputs' --logging_dir './logs' --ddp_find_unused_parameters False\n",
                "environmentId": "[resourceId('Microsoft.MachineLearningServices/workspaces/environments/versions', parameters('workspaces_TxtsumDemo_name'), 'hf-zero-gpu', '1')]",
                "inputDataBindings": {},
                "outputDataBindings": {},
                "distribution": {
                    "distributionType": "PyTorch",
                    "processCount": 8
                },
                "environmentVariables": {}
            }
        },
        {
            "type": "Microsoft.MachineLearningServices/workspaces/jobs",
            "apiVersion": "2021-03-01-preview",
            "name": "[concat(parameters('workspaces_TxtsumDemo_name'), '/dfe9d05d-f6ae-4ced-bc16-fff270809dae')]",
            "dependsOn": [
                "[resourceId('Microsoft.MachineLearningServices/workspaces', parameters('workspaces_TxtsumDemo_name'))]",
                "[resourceId('Microsoft.MachineLearningServices/workspaces/computes', parameters('workspaces_TxtsumDemo_name'), 'gpu-v100-8')]",
                "[resourceId('Microsoft.MachineLearningServices/workspaces/environments/versions', parameters('workspaces_TxtsumDemo_name'), 'hf-zero-gpu', '1')]",
                "[resourceId('Microsoft.MachineLearningServices/workspaces/data/versions', parameters('workspaces_TxtsumDemo_name'), 'hf-samsum', '1')]"
            ],
            "properties": {
                "description": "Hyperparameter tune an encoder-decoder Transformer model (BART) for dialogue summarization (SAMSum) with a grid search sweep job.",
                "tags": {
                    "_aml_system_max_concurrent_jobs": "1",
                    "max_concurrent_jobs": "1",
                    "_aml_system_max_total_jobs": "4",
                    "max_total_jobs": "4",
                    "_aml_system_max_duration_minutes": "60",
                    "max_duration_minutes": "60",
                    "_aml_system_policy_config": "{\"name\": \"DEFAULT\", \"properties\": {}}",
                    "policy_config": "{\"name\": \"DEFAULT\", \"properties\": {}}",
                    "_aml_system_generator_config": "{\"name\": \"GRID\", \"parameter_space\": {\"lr\": [\"choice\", [[3e-05, 5e-05]]], \"wd\": [\"choice\", [[0.0, 0.1]]]}}",
                    "generator_config": "{\"name\": \"GRID\", \"parameter_space\": {\"lr\": [\"choice\", [[3e-05, 5e-05]]], \"wd\": [\"choice\", [[0.0, 0.1]]]}}",
                    "_aml_system_primary_metric_config": "{\"name\": \"eval_rouge1\", \"goal\": \"maximize\"}",
                    "primary_metric_config": "{\"name\": \"eval_rouge1\", \"goal\": \"maximize\"}",
                    "_aml_system_platform_config": "{\"ServiceAddress\": \"https://westus2.api.azureml.ms\", \"SubscriptionId\": \"6560575d-fa06-4e7d-95fb-f962e74efd7a\", \"ResourceGroupName\": \"UW-Embeddings\", \"WorkspaceName\": \"TxtsumDemo\", \"ExperimentName\": \"hf-sweep-demo\", \"Definition\": {\"Configuration\": null, \"Attribution\": null, \"TelemetryValues\": null, \"Overrides\": {\"Script\": null, \"Command\": \"python -m torch.distributed.launch  --nproc_per_node 8 main.py  --model_name_or_path \\\"facebook/bart-large\\\"  --config_name \\\"./configs/hf-bart-xsum.json\\\"  --dataset_name \\\"samsum\\\"  --dataset_path $AZURE_ML_INPUT_corpus  --max_source_length 512  --max_target_length 90  --fp16 True  --seed 1  --per_device_train_batch_size 16  --per_device_eval_batch_size 16  --gradient_accumulation_steps 1  --learning_rate $AZUREML_SWEEP_lr  --num_train_epochs 3.0  --weight_decay $AZUREML_SWEEP_wd --evaluation_strategy \\\"epoch\\\"  --logging_strategy \\\"epoch\\\"  --do_train  --do_predict  --predict_with_generate  --overwrite_output_dir  --output_dir \\\"./outputs\\\"  --logging_dir \\\"./logs\\\"  --ddp_find_unused_parameters False\\n\", \"UseAbsolutePath\": true, \"Arguments\": [], \"SourceDirectoryDataStore\": null, \"Framework\": 0, \"Target\": \"gpu-v100-8\", \"DataReferences\": {}, \"Data\": {\"corpus\": {\"DataLocation\": {\"Dataset\": {\"Id\": \"f83f717c-5b08-42ec-8244-e1e266804153\", \"Name\": null, \"Version\": null}, \"DataPath\": null, \"Uri\": null}, \"Mechanism\": \"Download\", \"EnvironmentVariableName\": \"AZURE_ML_INPUT_corpus\", \"PathOnCompute\": null, \"Overwrite\": false, \"Options\": {\"ReadWrite\": \"False\", \"ForceFolder\": \"False\"}}}, \"OutputData\": {}, \"Datacaches\": [], \"JobName\": null, \"MaxRunDurationSeconds\": null, \"NodeCount\": 1, \"Priority\": null, \"CredentialPassthrough\": false, \"Identity\": null, \"Environment\": {\"Name\": \"hf-zero-gpu\", \"Version\": \"1\", \"Python\": {\"InterpreterPath\": null, \"UserManagedDependencies\": false, \"CondaDependencies\": {\"channels\": [\"pytorch\", \"nvidia\", \"conda-forge\"], \"dependencies\": [\"python=3.8\", \"pytorch=1.9.0\", \"cudatoolkit=11.1\", \"pip\", {\"pip\": [\"numpy\", \"nltk\", \"protobuf\", \"py7zr\", \"sentencepiece\", \"datasets\", \"git+https://github.com/huggingface/transformers\", \"rouge-score\", \"mlflow\", \"azureml-mlflow\", \"codecarbon\", \"deepspeed\", \"fairscale\"]}], \"name\": \"azureml_8db0ad68ca506622653cab01e942c9da\"}, \"BaseCondaEnvironment\": null}, \"EnvironmentVariables\": {}, \"Docker\": {\"BaseImage\": \"mcr.microsoft.com/azureml/openmpi4.1.0-cuda11.1-cudnn8-ubuntu18.04:latest\", \"Platform\": {\"Os\": \"Linux\", \"Architecture\": \"amd64\"}, \"BaseDockerfile\": null, \"BaseImageRegistry\": null}, \"Spark\": {\"Repositories\": [], \"Packages\": [], \"PrecachePackages\": true}, \"InferencingStackVersion\": null}, \"History\": {\"OutputCollection\": true, \"DirectoriesToWatch\": [\"logs\"], \"EnableMLflowTracking\": true}, \"Spark\": {\"Configuration\": {}}, \"ParallelTask\": {\"MaxRetriesPerWorker\": 0, \"WorkerCountPerNode\": 1, \"TerminalExitCodes\": null, \"Configuration\": {}}, \"BatchAi\": {\"NodeCount\": 0}, \"AmlCompute\": {\"Name\": null, \"VmSize\": null, \"RetainCluster\": false, \"ClusterMaxNodeCount\": null}, \"AISuperComputer\": {\"InstanceType\": \"AISupercomputer.D2\", \"FrameworkImage\": null, \"ImageVersion\": \"pytorch-1.7.0\", \"Location\": null, \"AISuperComputerStorageData\": null, \"Interactive\": false, \"ScalePolicy\": null, \"VirtualClusterArmId\": null, \"TensorboardLogDirectory\": null, \"SSHPublicKey\": null, \"EnableAzmlInt\": true, \"Priority\": \"Medium\", \"SLATier\": \"Standard\", \"UserAlias\": null}, \"KubernetesCompute\": {\"InstanceType\": null}, \"Tensorflow\": {\"WorkerCount\": 0, \"ParameterServerCount\": 0}, \"Mpi\": {\"ProcessCountPerNode\": 0}, \"PyTorch\": {\"CommunicationBackend\": null, \"ProcessCount\": null}, \"Hdi\": {\"YarnDeployMode\": 0}, \"ContainerInstance\": {\"Region\": null, \"CpuCores\": 2.0, \"MemoryGb\": 3.5}, \"ExposedPorts\": null, \"Docker\": {\"UseDocker\": true, \"SharedVolumes\": null, \"ShmSize\": null, \"Arguments\": null}, \"Cmk8sCompute\": {\"Configuration\": {}}, \"CommandReturnCodeConfig\": {\"ReturnCode\": 0, \"SuccessfulReturnCodes\": []}, \"ApplicationEndpoints\": {}, \"Parameters\": [], \"DataBricks\": {\"Workers\": 0, \"MinimumWorkerCount\": 0, \"MaxMumWorkerCount\": 0, \"SparkVersion\": \"4.0.x-scala2.11\", \"NodeTypeId\": \"Standard_D3_v2\", \"SparkConf\": {}, \"SparkEnvVars\": {}, \"InstancePoolId\": null, \"TimeoutSeconds\": 0, \"JarLibraries\": [], \"EggLibraries\": [], \"WhlLibraries\": [], \"PypiLibraries\": [], \"RCranLibraries\": [], \"MavenLibraries\": []}}, \"SnapshotId\": \"c1155bbd-5542-4013-8b2b-2738a478da24\", \"Snapshots\": [], \"SourceCodeDataReference\": null, \"ParentRunId\": null, \"DataContainerId\": null, \"RunType\": null, \"DisplayName\": \"dfe9d05d-f6ae-4ced-bc16-fff270809dae\", \"Properties\": {\"mlflow.source.git.repoURL\": \"git@github.com:henryu-lin/greenai-dev.git\", \"mlflow.source.git.branch\": \"main\", \"mlflow.source.git.commit\": \"818e49c4b1f4e7830fd3b87527dddfe5872d7ab4\", \"azureml.git.dirty\": \"True\"}, \"Tags\": {}, \"AggregatedArtifactPath\": null}}",
                    "platform_config": "{\"ServiceAddress\": \"https://westus2.api.azureml.ms\", \"SubscriptionId\": \"6560575d-fa06-4e7d-95fb-f962e74efd7a\", \"ResourceGroupName\": \"UW-Embeddings\", \"WorkspaceName\": \"TxtsumDemo\", \"ExperimentName\": \"hf-sweep-demo\", \"Definition\": {\"Configuration\": null, \"Attribution\": null, \"TelemetryValues\": null, \"Overrides\": {\"Script\": null, \"Command\": \"python -m torch.distributed.launch  --nproc_per_node 8 main.py  --model_name_or_path \\\"facebook/bart-large\\\"  --config_name \\\"./configs/hf-bart-xsum.json\\\"  --dataset_name \\\"samsum\\\"  --dataset_path $AZURE_ML_INPUT_corpus  --max_source_length 512  --max_target_length 90  --fp16 True  --seed 1  --per_device_train_batch_size 16  --per_device_eval_batch_size 16  --gradient_accumulation_steps 1  --learning_rate $AZUREML_SWEEP_lr  --num_train_epochs 3.0  --weight_decay $AZUREML_SWEEP_wd --evaluation_strategy \\\"epoch\\\"  --logging_strategy \\\"epoch\\\"  --do_train  --do_predict  --predict_with_generate  --overwrite_output_dir  --output_dir \\\"./outputs\\\"  --logging_dir \\\"./logs\\\"  --ddp_find_unused_parameters False\\n\", \"UseAbsolutePath\": true, \"Arguments\": [], \"SourceDirectoryDataStore\": null, \"Framework\": 0, \"Target\": \"gpu-v100-8\", \"DataReferences\": {}, \"Data\": {\"corpus\": {\"DataLocation\": {\"Dataset\": {\"Id\": \"f83f717c-5b08-42ec-8244-e1e266804153\", \"Name\": null, \"Version\": null}, \"DataPath\": null, \"Uri\": null}, \"Mechanism\": \"Download\", \"EnvironmentVariableName\": \"AZURE_ML_INPUT_corpus\", \"PathOnCompute\": null, \"Overwrite\": false, \"Options\": {\"ReadWrite\": \"False\", \"ForceFolder\": \"False\"}}}, \"OutputData\": {}, \"Datacaches\": [], \"JobName\": null, \"MaxRunDurationSeconds\": null, \"NodeCount\": 1, \"Priority\": null, \"CredentialPassthrough\": false, \"Identity\": null, \"Environment\": {\"Name\": \"hf-zero-gpu\", \"Version\": \"1\", \"Python\": {\"InterpreterPath\": null, \"UserManagedDependencies\": false, \"CondaDependencies\": {\"channels\": [\"pytorch\", \"nvidia\", \"conda-forge\"], \"dependencies\": [\"python=3.8\", \"pytorch=1.9.0\", \"cudatoolkit=11.1\", \"pip\", {\"pip\": [\"numpy\", \"nltk\", \"protobuf\", \"py7zr\", \"sentencepiece\", \"datasets\", \"git+https://github.com/huggingface/transformers\", \"rouge-score\", \"mlflow\", \"azureml-mlflow\", \"codecarbon\", \"deepspeed\", \"fairscale\"]}], \"name\": \"azureml_8db0ad68ca506622653cab01e942c9da\"}, \"BaseCondaEnvironment\": null}, \"EnvironmentVariables\": {}, \"Docker\": {\"BaseImage\": \"mcr.microsoft.com/azureml/openmpi4.1.0-cuda11.1-cudnn8-ubuntu18.04:latest\", \"Platform\": {\"Os\": \"Linux\", \"Architecture\": \"amd64\"}, \"BaseDockerfile\": null, \"BaseImageRegistry\": null}, \"Spark\": {\"Repositories\": [], \"Packages\": [], \"PrecachePackages\": true}, \"InferencingStackVersion\": null}, \"History\": {\"OutputCollection\": true, \"DirectoriesToWatch\": [\"logs\"], \"EnableMLflowTracking\": true}, \"Spark\": {\"Configuration\": {}}, \"ParallelTask\": {\"MaxRetriesPerWorker\": 0, \"WorkerCountPerNode\": 1, \"TerminalExitCodes\": null, \"Configuration\": {}}, \"BatchAi\": {\"NodeCount\": 0}, \"AmlCompute\": {\"Name\": null, \"VmSize\": null, \"RetainCluster\": false, \"ClusterMaxNodeCount\": null}, \"AISuperComputer\": {\"InstanceType\": \"AISupercomputer.D2\", \"FrameworkImage\": null, \"ImageVersion\": \"pytorch-1.7.0\", \"Location\": null, \"AISuperComputerStorageData\": null, \"Interactive\": false, \"ScalePolicy\": null, \"VirtualClusterArmId\": null, \"TensorboardLogDirectory\": null, \"SSHPublicKey\": null, \"EnableAzmlInt\": true, \"Priority\": \"Medium\", \"SLATier\": \"Standard\", \"UserAlias\": null}, \"KubernetesCompute\": {\"InstanceType\": null}, \"Tensorflow\": {\"WorkerCount\": 0, \"ParameterServerCount\": 0}, \"Mpi\": {\"ProcessCountPerNode\": 0}, \"PyTorch\": {\"CommunicationBackend\": null, \"ProcessCount\": null}, \"Hdi\": {\"YarnDeployMode\": 0}, \"ContainerInstance\": {\"Region\": null, \"CpuCores\": 2.0, \"MemoryGb\": 3.5}, \"ExposedPorts\": null, \"Docker\": {\"UseDocker\": true, \"SharedVolumes\": null, \"ShmSize\": null, \"Arguments\": null}, \"Cmk8sCompute\": {\"Configuration\": {}}, \"CommandReturnCodeConfig\": {\"ReturnCode\": 0, \"SuccessfulReturnCodes\": []}, \"ApplicationEndpoints\": {}, \"Parameters\": [], \"DataBricks\": {\"Workers\": 0, \"MinimumWorkerCount\": 0, \"MaxMumWorkerCount\": 0, \"SparkVersion\": \"4.0.x-scala2.11\", \"NodeTypeId\": \"Standard_D3_v2\", \"SparkConf\": {}, \"SparkEnvVars\": {}, \"InstancePoolId\": null, \"TimeoutSeconds\": 0, \"JarLibraries\": [], \"EggLibraries\": [], \"WhlLibraries\": [], \"PypiLibraries\": [], \"RCranLibraries\": [], \"MavenLibraries\": []}}, \"SnapshotId\": \"c1155bbd-5542-4013-8b2b-2738a478da24\", \"Snapshots\": [], \"SourceCodeDataReference\": null, \"ParentRunId\": null, \"DataContainerId\": null, \"RunType\": null, \"DisplayName\": \"dfe9d05d-f6ae-4ced-bc16-fff270809dae\", \"Properties\": {\"mlflow.source.git.repoURL\": \"git@github.com:henryu-lin/greenai-dev.git\", \"mlflow.source.git.branch\": \"main\", \"mlflow.source.git.commit\": \"818e49c4b1f4e7830fd3b87527dddfe5872d7ab4\", \"azureml.git.dirty\": \"True\"}, \"Tags\": {}, \"AggregatedArtifactPath\": null}}",
                    "_aml_system_resume_child_runs": "null",
                    "resume_child_runs": "null",
                    "_aml_system_all_jobs_generated": "true",
                    "all_jobs_generated": "true",
                    "_aml_system_cancellation_requested": "false",
                    "cancellation_requested": "false",
                    "_aml_system_progress_metadata_evaluation_timestamp": "\"2021-08-25T23:03:42.329131\"",
                    "progress_metadata_evaluation_timestamp": "\"2021-08-25T23:03:42.329131\"",
                    "_aml_system_progress_metadata_digest": "\"02cca26be07fc764603c3771d21edea77cd6e98d4a2594f4d707e164490829ee\"",
                    "progress_metadata_digest": "\"02cca26be07fc764603c3771d21edea77cd6e98d4a2594f4d707e164490829ee\"",
                    "_aml_system_progress_metadata_active_timestamp": "\"2021-08-25T23:03:42.329131\"",
                    "progress_metadata_active_timestamp": "\"2021-08-25T23:03:42.329131\"",
                    "_aml_system_optimizer_state_artifact": "null",
                    "_aml_system_outdated_optimizer_state_artifacts": "\"[]\"",
                    "_aml_system_dfe9d05d-f6ae-4ced-bc16-fff270809dae_0": "{\"lr\": 3e-05, \"wd\": 0.0}",
                    "_aml_system_dfe9d05d-f6ae-4ced-bc16-fff270809dae_1": "{\"lr\": 3e-05, \"wd\": 0.1}",
                    "_aml_system_dfe9d05d-f6ae-4ced-bc16-fff270809dae_2": "{\"lr\": 5e-05, \"wd\": 0.0}",
                    "_aml_system_dfe9d05d-f6ae-4ced-bc16-fff270809dae_3": "{\"lr\": 5e-05, \"wd\": 0.1}"
                },
                "properties": {
                    "primary_metric_config": "{\"name\": \"eval_rouge1\", \"goal\": \"maximize\"}",
                    "resume_from": "null",
                    "runTemplate": "HyperDrive",
                    "azureml.runsource": "hyperdrive",
                    "platform": "AML",
                    "mlflow.source.git.repoURL": "git@github.com:henryu-lin/greenai-dev.git",
                    "mlflow.source.git.branch": "main",
                    "mlflow.source.git.commit": "818e49c4b1f4e7830fd3b87527dddfe5872d7ab4",
                    "azureml.git.dirty": "True",
                    "ContentSnapshotId": "c1155bbd-5542-4013-8b2b-2738a478da24",
                    "user_agent": "managementfrontend/e2af6b568f52511fd24fc4e2db129a0c4b63c10a",
                    "score": "55.0234",
                    "best_child_run_id": "dfe9d05d-f6ae-4ced-bc16-fff270809dae_3",
                    "best_metric_status": "Succeeded"
                },
                "jobType": "Sweep",
                "compute": {
                    "target": "[resourceId('Microsoft.MachineLearningServices/workspaces/computes', parameters('workspaces_TxtsumDemo_name'), 'gpu-v100-8')]",
                    "instanceCount": 1,
                    "isLocal": false
                },
                "experimentName": "hf-sweep-demo",
                "searchSpace": {
                    "lr": [
                        "choice",
                        [
                            [
                                0.00003,
                                0.00005
                            ]
                        ]
                    ],
                    "wd": [
                        "choice",
                        [
                            [
                                0,
                                0.1
                            ]
                        ]
                    ]
                },
                "algorithm": "Grid",
                "maxTotalTrials": 4,
                "maxConcurrentTrials": 1,
                "timeout": "PT1H",
                "objective": {
                    "primaryMetric": "eval_rouge1",
                    "goal": "Maximize"
                },
                "trial": {
                    "codeId": "[concat(resourceId('Microsoft.MachineLearningServices/workspaces', parameters('workspaces_TxtsumDemo_name')), '/codes/eba8e7f5-3c52-414f-8be1-3b4cb5a6d1d4/versions/1')]",
                    "command": "python -m torch.distributed.launch  --nproc_per_node 8 main.py  --model_name_or_path \"facebook/bart-large\"  --config_name \"./configs/hf-bart-xsum.json\"  --dataset_name \"samsum\"  --dataset_path $AZURE_ML_INPUT_corpus  --max_source_length 512  --max_target_length 90  --fp16 True  --seed 1  --per_device_train_batch_size 16  --per_device_eval_batch_size 16  --gradient_accumulation_steps 1  --learning_rate $AZUREML_SWEEP_lr  --num_train_epochs 3.0  --weight_decay $AZUREML_SWEEP_wd --evaluation_strategy \"epoch\"  --logging_strategy \"epoch\"  --do_train  --do_predict  --predict_with_generate  --overwrite_output_dir  --output_dir \"./outputs\"  --logging_dir \"./logs\"  --ddp_find_unused_parameters False\n",
                    "environmentId": "[resourceId('Microsoft.MachineLearningServices/workspaces/environments/versions', parameters('workspaces_TxtsumDemo_name'), 'hf-zero-gpu', '1')]",
                    "inputDataBindings": {
                        "corpus": {
                            "dataId": "[resourceId('Microsoft.MachineLearningServices/workspaces/data/versions', parameters('workspaces_TxtsumDemo_name'), 'hf-samsum', '1')]",
                            "mode": "Download"
                        }
                    },
                    "environmentVariables": {}
                }
            }
        }
    ]
}