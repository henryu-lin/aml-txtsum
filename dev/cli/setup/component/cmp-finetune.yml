type: command_component

name: hf-finetune
display_name: HuggingFace Finetune
version: 1

inputs:
    dataset:
        type: path
        description: "corpus path"
outputs:
    output_dir:
        type: path
    logging_dir:
        type: path

code:
    local_path: ../../src

environment: azureml:hf-base:1

command: >
    python trainer-wip.py 
    --model_name_or_path "facebook/bart-large" 
    --config_name "facebook/bart-large-xsum" 
    --dataset_name "xsum" 
    --dataset_path {inputs.dataset} 
    --max_source_length 512 
    --max_target_length 64 
    --seed 322 
    --fp16 True 
    --sortish_sampler True 
    --max_eval_samples 256 
    --max_predict_samples 256 
    --per_device_train_batch_size 1 
    --per_device_eval_batch_size 4 
    --gradient_accumulation_steps 32 
    --max_steps 10 
    --evaluation_strategy "steps" 
    --logging_strategy "steps" 
    --eval_steps 10 
    --logging_steps 5 
    --save_total_limit 10 
    --load_best_model_at_end True 
    --metric_for_best_model "eval_rouge2" 
    --greater_is_better True 
    --do_train 
    --do_predict 
    --predict_with_generate 
    --overwrite_output_dir 
    --output_dir {inputs.output_dir} 
    --logging_dir {inputs.logging_dir} 
    --cache_dir "./cache"